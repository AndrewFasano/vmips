## Process this file with automake to produce Makefile.in.

# The following subdirectories have makefiles:
SUBDIRS = vmips.misc-tests vmips.outcheck vmips.regcheck

# We are running tests in this directory.
AUTOMAKE_OPTIONS = dejagnu

# Also need to distribute the following files:
EXTRA_DIST = \
	config/unix.exp \
	lib/vmips-misc.exp \
	lib/vmips-outcheck.exp \
	lib/vmips-regcheck.exp \
	lib/vmips.exp

# Extra things to clean up:
CLEANFILES = vmips.log dbg.log vmips.sum
DISTCLEANFILES = site.exp

# We need our own site.exp rule so that we can pass endian_flag down
# to the testsuite. 

ENDIAN_FLAG = @ENDIAN_FLAG@

site.exp: Makefile
	@echo 'Making a new site.exp file...'
	@test ! -f site.bak || rm -f site.bak
	@echo '## these variables are automatically generated by make ##' > $@-t
	@echo '# Do not edit here.  If you wish to override these values' >> $@-t
	@echo '# edit the last section' >> $@-t
	@echo 'set tool $(DEJATOOL)' >> $@-t
	@echo 'set srcdir $(srcdir)' >> $@-t
	@echo 'set objdir' `pwd` >> $@-t
	@echo 'set host_alias $(host_alias)' >> $@-t
	@echo 'set host_triplet $(host_triplet)' >> $@-t
	@echo 'set target_alias $(target_alias)' >> $@-t
	@echo 'set target_triplet $(target_triplet)' >> $@-t
	@echo 'set build_alias $(build_alias)' >> $@-t
	@echo 'set build_triplet $(build_triplet)' >> $@-t
	@echo 'set endian_flag $(ENDIAN_FLAG)' >> $@-t
	@echo '## All variables above are 0wned by configure. Do Not Edit ##' >> $@-t
	@test ! -f site.exp || sed '1,/^## All variables above are.*##/ d' site.exp >> $@-t
	@test ! -f site.exp || mv site.exp site.bak
	@mv $@-t site.exp
